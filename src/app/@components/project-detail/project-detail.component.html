<!-- Imagen principal como <img> para SEO -->
<div *ngIf="innerWidth && innerHeight" class="project-landig">
  <img
    [src]="getMainImageUrl()"
    [alt]="'Imagen principal de ' + data?.name"
    class="main-image"
    loading="eager"
    fetchpriority="high"
    decoding="sync"
  />
  <div class="overlay"></div>
  <span class="name">{{ getProjectName() }}</span>
  <span class="m2" *ngIf="data?.m2">{{ data?.m2 }}m<sup>2</sup></span>
</div>

<section
  class="planta-container"
  *ngIf="data?.plantaSrc || data?.plantaPreviaSrc || data?.description"
>
  <!-- Contenido principal: Plano y Descripción -->
  <div class="planta-content">
    <!-- Planos del proyecto (izquierda) -->
    <div
      class="planta-section"
      [class.has-previa]="data?.plantaPreviaSrc"
      *ngIf="data?.plantaSrc || data?.plantaPreviaSrc"
    >
      <!-- Planta Original (Previa) -->
      <div
        class="planta-image-container planta-previa"
        *ngIf="data?.plantaPreviaSrc"
      >
        <img
          [src]="getPlantaPreviaImageUrl()"
          [alt]="'Plano original de ' + data?.name"
          class="planta-image"
          loading="lazy"
          decoding="async"
        />
        <div class="planta-info">
          <span class="planta-label">{{ "plantaOriginal" | translate }}</span>
        </div>
      </div>

      <!-- Planta del Proyecto -->
      <div
        class="planta-image-container planta-proyecto"
        *ngIf="data?.plantaSrc"
      >
        <img
          [src]="getPlantaImageUrl()"
          [alt]="'Plano de proyecto de ' + data?.name"
          class="planta-image"
          loading="lazy"
          decoding="async"
          (error)="onPlantaImageError($event)"
          (load)="onPlantaImageLoad($event)"
        />
        <!-- Fallback si la imagen no carga -->
        <div class="planta-fallback" *ngIf="!plantaImageLoaded">
          <div class="fallback-content">
            <span>Plano del proyecto</span>
            <small>{{ data?.plantaSrc }}</small>
          </div>
        </div>
        <div class="planta-info">
          <span class="planta-label">{{ "plantaProyecto" | translate }}</span>
        </div>
      </div>
    </div>

    <!-- Contenido derecho: Descripción e Info del proyecto -->
    <div class="right-content">
      <!-- Descripción del proyecto -->
      <div
        class="project-description"
        *ngIf="data?.description || data?.descriptionEn"
      >
        <p>{{ getProjectDescription() }}</p>
      </div>

      <!-- Información del proyecto -->
      <div
        class="project-info"
        *ngIf="data?.m2 || data?.location || data?.year"
      >
        <!-- Especificaciones del proyecto -->
        <div class="project-specs">
          <div class="specs-container">
            <!-- Elemento Year -->
            <div class="spec-item" *ngIf="data?.year">
              <span class="spec-label">{{ "year" | translate }}:</span>
              <span class="spec-value">{{ data?.year }}</span>
            </div>

            <!-- Elemento M² -->
            <div class="spec-item" *ngIf="data?.m2">
              <span class="spec-label">{{ "dimension" | translate }}:</span>
              <span class="spec-value">{{ data?.m2 }}M²</span>
            </div>

            <!-- Elemento Location -->
            <div class="spec-item" *ngIf="data?.location">
              <span class="spec-label">{{ "location" | translate }}:</span>
              <span class="spec-value">{{ data?.location }}</span>
            </div>

            <!-- Elemento Style -->
            <div class="spec-item" *ngIf="data?.mainFeature?.type === 'image'">
              <span class="spec-value">{{ data?.style || "" }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<section class="images-container" *ngIf="innerWidth && innerHeight">
  @for (image of data?.images; track $index; let i = $index) {
  <div
    [ngStyle]="{
      'grid-row': 'span ' + calculateImageRows(image, i),
      'grid-column': 'span ' + calculateImageColumns(image, i),
      position: 'relative'
    }"
    (click)="openCarrousel($index)"
    class="image-container"
  >
    @if(!breakpoint.isMobile()){
    <img
      class="image-desktop"
      [src]="getGalleryImageUrl(image.src)"
      [alt]="'Imagen de ' + data?.name + ' - Foto ' + (i + 1)"
      [loading]="i < 6 ? 'eager' : 'lazy'"
      decoding="async"
      [attr.fetchpriority]="i < 3 ? 'high' : i < 6 ? 'auto' : 'low'"
    />
    } @else if(innerWidth > 0 && getGalleryImageUrl(image.src)) {
    <img
      class="image-mobile"
      [src]="getGalleryImageUrl(image.src)"
      [alt]="'Imagen de ' + data?.name + ' - Foto ' + (i + 1)"
      [width]="innerWidth"
      [height]="300"
      [loading]="i < 4 ? 'eager' : 'lazy'"
      decoding="async"
      [attr.fetchpriority]="i < 2 ? 'high' : i < 4 ? 'auto' : 'low'"
    />
    }
  </div>
  }
</section>

@if(openCarrouselFlag && data?.images){
<div #carrousel class="carrousel" (click)="handleBackdropClick($event)">
  <div class="carrousel-content" (click)="$event.stopPropagation()">
    <button
      class="nav-button prev"
      (click)="prevImage()"
      [disabled]="!hasPrevImage()"
    >
      <mat-icon>chevron_left</mat-icon>
    </button>

    <!-- Imagen actual -->
    <section
      class="carrousel-imgContainer"
      [class.changing]="isChangingImage"
      [style.background-image]="
        currentImageLoaded ? 'url(' + getCurrentImageUrl() + ')' : 'none'
      "
    >
      @if(isLoadingImage || !currentImageLoaded){
      <div class="loading-overlay">
        <mat-spinner diameter="60" strokeWidth="6"></mat-spinner>
        <p class="loading-text">{{ "loadingImage" | translate }}</p>
      </div>
      }
    </section>

    <!-- Botón Next -->
    <button
      class="nav-button next"
      (click)="nextImage()"
      [disabled]="!hasNextImage()"
    >
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>
  <!-- Botón Previous -->
</div>
}
