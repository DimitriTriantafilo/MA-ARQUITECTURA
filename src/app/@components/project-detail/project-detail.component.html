<!-- Imagen principal como <img> para SEO -->
<div *ngIf="innerWidth && innerHeight" class="project-landig">
  <img
    [src]="getMainImageUrl()"
    [alt]="'Imagen principal de ' + data?.name"
    class="main-image"
    loading="eager"
    fetchpriority="high"
    decoding="sync"
  />
  <div class="overlay"></div>
  <span class="name">{{ data?.name }}</span>
  <span class="m2" *ngIf="data?.m2">{{ data?.m2 }}m<sup>2</sup></span>
</div>

<section class="images-container" *ngIf="innerWidth && innerHeight">
  @for (image of data?.images; track $index; let i = $index) {
  <div
    [ngStyle]="{
      'grid-row': 'span ' + calculateImageRows(image, i),
      'grid-column': 'span ' + calculateImageColumns(image, i),
      position: 'relative'
    }"
    (click)="openCarrousel($index)"
    class="image-container"
  >
    @if(!breakpoint.isMobile()){
    <img
      class="image-desktop"
      [src]="getGalleryImageUrl(image.src)"
      [alt]="'Imagen de ' + data?.name + ' - Foto ' + (i + 1)"
      [loading]="i < 6 ? 'eager' : 'lazy'"
      decoding="async"
      [attr.fetchpriority]="i < 3 ? 'high' : i < 6 ? 'auto' : 'low'"
    />
    } @else if(innerWidth > 0 && getGalleryImageUrl(image.src)) {
    <img
      class="image-mobile"
      [src]="getGalleryImageUrl(image.src)"
      [alt]="'Imagen de ' + data?.name + ' - Foto ' + (i + 1)"
      [width]="innerWidth"
      [height]="300"
      [loading]="i < 4 ? 'eager' : 'lazy'"
      decoding="async"
      [attr.fetchpriority]="i < 2 ? 'high' : i < 4 ? 'auto' : 'low'"
    />
    }
  </div>
  }
</section>

@if(openCarrouselFlag && data?.images){
<div #carrousel class="carrousel" (click)="handleBackdropClick($event)">
  <div class="carrousel-content" (click)="$event.stopPropagation()">
    <button
      class="nav-button prev"
      (click)="prevImage()"
      [disabled]="!hasPrevImage()"
    >
      <mat-icon>chevron_left</mat-icon>
    </button>

    <!-- Imagen actual -->
    <section
      class="carrousel-imgContainer"
      [class.changing]="isChangingImage"
      [style.background-image]="
        currentImageLoaded ? 'url(' + getCurrentImageUrl() + ')' : 'none'
      "
    >
      @if(isLoadingImage || !currentImageLoaded){
      <div class="loading-overlay">
        <mat-spinner diameter="60" strokeWidth="6"></mat-spinner>
        <p class="loading-text">Cargando imagen...</p>
      </div>
      }
    </section>

    <!-- Botón Next -->
    <button
      class="nav-button next"
      (click)="nextImage()"
      [disabled]="!hasNextImage()"
    >
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>
  <!-- Botón Previous -->
</div>
}
